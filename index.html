<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Objedn√°vka ta≈°ek ‚Äî WM Hole≈°ovice</title>
<style>
:root{
  --wolt-blue-1:#00bfff; --wolt-blue-2:#007acc;
  --bg:#f6f8fb; --card:#fff; --muted:#6b7280;
  --red:#ff4c4c; --orange:#ff9b2f; --green:#2ecc71;
  --radius:12px; --shadow:0 10px 30px rgba(15,23,42,0.08);
}
body.dark{
  --bg:#071018; --card:#0b1220; --muted:#9aa4b2;
  --red:#ff7b7b; --orange:#ffb567; --green:#6ee28f;
  --shadow:0 12px 36px rgba(2,6,23,0.6);
}
body{margin:0;padding:12px;font-family:Inter,sans-serif;background:var(--bg);color:#0b1220;transition: background .3s,color .3s;}
body.dark{color:#e6eef6;}
.container{max-width:700px;margin:0 auto;display:flex;flex-direction:column;gap:16px;}
.header{display:flex;gap:12px;align-items:center;flex-wrap:wrap;}
.logo{width:56px;height:56px;border-radius:12px;display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:20px;background:linear-gradient(135deg,var(--wolt-blue-1),var(--wolt-blue-2)); box-shadow:var(--shadow);transition:transform .2s;}
.logo:hover{transform:translateY(-2px);}
.title{font-weight:800;font-size:18px;}
.subtitle{font-size:13px;color:var(--muted);margin-top:4px;}
.controls{margin-left:auto;display:flex;gap:12px;align-items:center;}
.card{background:var(--card);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:12px;transition:transform .2s;}
.card:hover{transform:translateY(-2px);}
h2{margin:0 0 10px 0;color:var(--wolt-blue-2);}
.inventory{display:flex;flex-direction:column;gap:12px;margin-top:6px;}
.item{display:flex;gap:12px;align-items:center;padding:12px;border-radius:10px;transition:transform .2s,background .25s;}
body:not(.dark) .item{background:linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.3));}
.ic{width:46px;height:46px;border-radius:10px;display:flex;align-items:center;justify-content:center;background: linear-gradient(135deg, rgba(0,0,0,0.04), rgba(255,255,255,0.04));color:var(--wolt-blue-2);flex-shrink:0;transition:transform .2s;font-size:20px;}
.ic:hover{transform:translateY(-2px);}
.meta{flex:1;min-width:0;}
.meta .name{font-weight:700;font-size:14px;}
.meta .code{font-size:12px;color:var(--muted);margin-top:4px;}
.qty-container{display:flex;gap:4px;align-items:center;justify-content:flex-end;flex-shrink:0;min-width:130px;position:relative;}
.qty-container input[type="number"], .order-row input[type="number"]{
  width:60px;padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.08);text-align:center;font-weight:700;background:transparent;color:inherit;transition:border .25s, color .25s, transform .2s;font-size:14px;
}
body.dark .qty-container input[type="number"], body.dark .order-row input[type="number"]{
  border:1px solid rgba(255,255,255,0.06);
  color:white;
  background: rgba(255,255,255,0.04);
}
.qty-btn{
  padding:6px 12px;
  border:none;
  border-radius:8px;
  background:var(--wolt-blue-1);
  color:white;
  font-weight:700;
  cursor:pointer;
  transition:transform .2s,background .2s,box-shadow .2s;
  font-size:14px;
}
.qty-btn:hover{
  transform:translateY(-2px);
  box-shadow:0 6px 15px rgba(0,191,255,0.4);
}
.qty-btn:active{
  transform:scale(0.95);
  box-shadow:0 3px 10px rgba(0,191,255,0.4);
}
.progress-container{
  width:100%;height:16px;background:#e6eef6;border-radius:8px;overflow:hidden;box-shadow:inset 0 -2px 4px rgba(0,0,0,0.08);
}
.progress-fill{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,var(--red),var(--green));
  transition: width 0.3s ease, background 0.3s ease;
  border-radius:6px;
}
.progress-fill.red{background:var(--red);}
.progress-fill.orange{background:var(--orange);}
.progress-fill.green{background:var(--green);}
.panel{display:flex;flex-direction:column;gap:14px;}
.order-row{display:flex;gap:6px;align-items:center;margin-bottom:10px;flex-wrap:wrap;}
.order-row .label{flex:1;font-weight:700;min-width:0;}
.cta{display:flex;gap:10px;flex-wrap:wrap;margin-top:6px;}
.btn-primary{display:inline-flex;gap:10px;align-items:center;background:linear-gradient(90deg,var(--wolt-blue-1),var(--wolt-blue-2));color:white;border:none;padding:12px 18px;border-radius:10px;cursor:pointer;font-weight:800;box-shadow:0 8px 20px rgba(0,120,200,0.16);transition:transform .2s;}
.btn-primary:hover{transform:translateY(-2px);}
.btn-ghost{background:transparent;border:1px solid rgba(0,0,0,0.06);padding:10px 12px;border-radius:10px;cursor:pointer;transition:transform .2s;}
.btn-ghost:hover{background:rgba(255,255,255,0.1);}
body.dark .btn-ghost{
  border:1px solid rgba(255,255,255,0.06);
  color:white;
}
.history-toggle{display:flex;align-items:center;gap:10px;cursor:pointer;user-select:none;margin-top:10px;color:var(--muted);transition:color .25s;}
.history-toggle:hover{color:var(--wolt-blue-2);}
.history-panel{margin-top:8px;max-height:0;overflow:hidden;transition:max-height .4s ease;}
.history-panel.open{max-height:1000px;}
.history-list{display:flex;flex-direction:column;gap:8px;margin-top:10px;}
.history-item{background:var(--card);padding:10px;border-radius:8px;display:flex;justify-content:space-between;gap:12px;align-items:flex-start;box-shadow:var(--shadow);transition:transform .2s,opacity .3s;}
.history-item:hover{transform:translateY(-1px);}
.history-item .left{flex:1;}
.small{font-size:13px;color:var(--muted);}
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:28px;background:#111827;color:white;padding:10px 16px;border-radius:10px;display:none;z-index:9999;box-shadow:0 8px 30px rgba(2,6,23,0.6);}
.toast.show{display:block;animation: pop .36s ease;}
.dark-toggle{
  width:40px;height:40px;display:flex;align-items:center;justify-content:center;
  font-size:20px;border-radius:50%;cursor:pointer;transition:all 0.3s ease;
  background:linear-gradient(135deg,#ffd700,#ff9b00);color:white;box-shadow:0 4px 12px rgba(0,0,0,0.15);
}
body.dark .dark-toggle{
  background:linear-gradient(135deg,#1a1a2e,#0d1b2a);
  color:#f0f0f0;
  transform:rotate(180deg);
}
body.dark #resetBtn, body.dark #clearHistory{
  color:white;
  background:rgba(255,255,255,0.05);
  border:1px solid rgba(255,255,255,0.15);
}
body.dark #resetBtn:hover, body.dark #clearHistory:hover{
  background:rgba(255,255,255,0.15);
}
@media(max-width:560px){.container{padding:8px}.logo{width:48px;height:48px;font-size:16px}.btn-primary{width:100%;justify-content:center}}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div style="display:flex;gap:12px;align-items:center">
      <div class="logo">WM</div>
      <div>
        <div class="title">Objedn√°vka ta≈°ek ‚Äî WM Hole≈°ovice</div>
        <div class="subtitle">P≈ôehled skladu ‚Ä¢ Rychl√° objedn√°vka</div>
      </div>
    </div>
    <div class="controls">
      <div id="darkToggle" class="dark-toggle">üåû</div>
    </div>
  </div>

  <!-- INVENTORY -->
  <div class="card">
    <h2>Stav skladu</h2>
    <div style="display:flex;gap:12px;margin-bottom:6px;font-weight:700;color:var(--muted)">
      <div style="flex:1"></div>
      <div style="width:90px;text-align:center">Krabice</div>
    </div>
    <div class="inventory" id="inventoryList" aria-live="polite"></div>
  </div>

  <!-- ORDER -->
  <div class="card panel">
    <h2>Objedn√°vka</h2>
    <div style="display:flex;gap:12px;margin-bottom:6px;font-weight:700;color:var(--muted)">
      <div style="flex:1"></div>
      <div style="width:90px;text-align:center">Palety</div>
    </div>

    <div class="order-row"><div class="label">Velk√© ta≈°ky</div><button class="qty-btn" data-target="o1" data-op="-">-</button><input id="o1" type="number" min="0" value="0"><button class="qty-btn" data-target="o1" data-op="+">+</button></div>
    <div class="order-row"><div class="label">Mal√© ta≈°ky</div><button class="qty-btn" data-target="o2" data-op="-">-</button><input id="o2" type="number" min="0" value="0"><button class="qty-btn" data-target="o2" data-op="+">+</button></div>
    <div class="order-row"><div class="label">Velk√© s√°ƒçky</div><button class="qty-btn" data-target="o3" data-op="-">-</button><input id="o3" type="number" min="0" value="0"><button class="qty-btn" data-target="o3" data-op="+">+</button></div>
    <div class="order-row"><div class="label">Mal√© s√°ƒçky</div><button class="qty-btn" data-target="o4" data-op="-">-</button><input id="o4" type="number" min="0" value="0"><button class="qty-btn" data-target="o4" data-op="+">+</button></div>

    <div class="cta">
      <button class="btn-primary" id="sendBtn">Odeslat do Gmailu</button>
      <button class="btn-ghost" id="resetBtn">Reset</button>
    </div>

    <div class="history-toggle" id="historyToggle">‚ñ∂ Historie objedn√°vek</div>
    <div class="history-panel" id="historyPanel">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:700;color:var(--muted)">Posledn√≠ objedn√°vky</div>
        <button class="btn-ghost" id="clearHistory">Vymazat historii</button>
      </div>
      <div class="history-list" id="historyList"></div>
    </div>
  </div>

  <div style="margin-top:6px;color:var(--muted);font-size:13px">
    Hlavn√≠ p≈ô√≠jemce: <strong>sklad.hrusov@vas-solutions.cz</strong><br>
    Kopie: jan.navratil@axm.cz, julie.husakova@wolt.com, wm.holesovice@wolt.com
  </div>

  <div class="toast" id="toast">Ulo≈æeno do historie</div>
</div>

<script type="module">
// --- Firebase ---
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics.js";

const firebaseConfig = {
  apiKey: "AIzaSyAT_FkCvSszAWiRvf119VLzs4r597dCDsY",
  authDomain: "wolt-tasky.firebaseapp.com",
  databaseURL: "https://wolt-tasky-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "wolt-tasky",
  storageBucket: "wolt-tasky.firebasedestorage.app",
  messagingSenderId: "611814484401",
  appId: "1:611814484401:web:98338743cbf1f73c8a3590",
  measurementId: "G-ERBTLVJ9DE"
};

const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const db = getDatabase(app);
const skladRef = ref(db, 'sklad');
const historyRef = ref(db, 'history');

const STORAGE_KEY="wm_sklad_final"; 
const HISTORY_KEY="wm_orders_final"; 
const HISTORY_LIMIT=20;
const defaultData=[
  { id:"132017040009", label:"Velk√© ta≈°ky 132017040009 Ta≈°ka Wolt Market 320x170x400mm", qty:12 },
  { id:"3122014030009", label:"Mal√© ta≈°ky 3122014030009 Ta≈°ka Wolt Market 220x140x300mm", qty:5 },
  { id:"32000100027000", label:"Velk√© s√°ƒçky 32000100027000 S√°ƒçek Wolt Market 200x90x370mm", qty:17 },
  { id:"3160505028000", label:"Mal√© s√°ƒçky 3160505028000 S√°ƒçek Wolt Market 160x50x280mm", qty:9 }
];

let sklad=JSON.parse(localStorage.getItem(STORAGE_KEY)||JSON.stringify(defaultData));
let history=JSON.parse(localStorage.getItem(HISTORY_KEY)||"[]");

const inventoryList=document.getElementById("inventoryList");
const historyList=document.getElementById("historyList");
const o1=document.getElementById("o1"), o2=document.getElementById("o2"), o3=document.getElementById("o3"), o4=document.getElementById("o4");

onValue(skladRef, snapshot => {
  const data = snapshot.val();
  if(data) {
    sklad = data;
    localStorage.setItem(STORAGE_KEY, JSON.stringify(sklad));
    renderInventory();
  }
});

onValue(historyRef, snapshot => {
  const data = snapshot.val();
  history = data ? Object.values(data) : [];
  localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
  renderHistory();
});

function updateFirebaseSklad(){ set(skladRef, sklad); }
function updateFirebaseHistory(){ set(historyRef, history); }

function getState(q){if(q<6)return"red";if(q<15)return"orange";return"green";}
function clampInt(v,min=0){v=parseInt(v);if(isNaN(v))return min;return Math.max(min,v);}

function renderInventory(){
  inventoryList.innerHTML = "";
  sklad.forEach((it, idx) => {
    const qty = Number(it.qty || 0);
    const state = getState(qty);
    const pct = Math.min(100, Math.round((qty / 30) * 100));

    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <div class="ic">üì¶</div>
      <div class="meta">
        <div class="name">${it.label}</div>
        <div class="code">${it.id}</div>
        <div class="progress-container">
          <div class="progress-fill ${state}" style="width:${pct}%"></div>
        </div>
      </div>
      <div class="qty-container">
        <button class="qty-btn" data-idx="${idx}" data-op="-">-</button>
        <input type="number" min="0" value="${qty}" data-idx="${idx}" />
        <button class="qty-btn" data-idx="${idx}" data-op="+">+</button>
      </div>
    `;
    inventoryList.appendChild(div);

    const input = div.querySelector('input[type=number]');
    const fill = div.querySelector('.progress-fill');

    function updateQty(newQty){
      sklad[idx].qty = newQty;
      localStorage.setItem(STORAGE_KEY, JSON.stringify(sklad));
      const pct = Math.min(100, Math.round(newQty / 30 * 100));
      const state = getState(newQty);
      fill.style.width = pct + '%';
      fill.className = 'progress-fill ' + state;
    }

    // --- INPUT: jen update p≈ôi blur ---
    input.addEventListener('blur', e=>{
      let v = parseInt(e.target.value);
      if(isNaN(v) || v < 0) v = 0;
      updateQty(v);
      updateFirebaseSklad();
    });

    div.querySelectorAll('.qty-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        let val = sklad[idx].qty + (btn.dataset.op === "+" ? 1 : -1);
        if (val < 0) val = 0;
        updateQty(val);
        input.value = val;
        updateFirebaseSklad();
      });
    });
  });
}

// --- ORDER ---
function onOrderBtnClick(e){
  const target=document.getElementById(e.currentTarget.dataset.target);
  let val=Number(target.value||0);
  val+=e.currentTarget.dataset.op==="+"?1:-1;
  if(val<0) val=0;
  target.value=val;
}

function renderHistory(){
  historyList.innerHTML="";
  history.slice().reverse().forEach(h=>{
    const div=document.createElement('div');
    div.className='history-item';
    div.innerHTML=`<div class="left"><div class="small">${h.date}</div>${h.text}</div>`;
    historyList.appendChild(div);
  });
}

document.getElementById("historyToggle").addEventListener("click",()=>{document.getElementById("historyPanel").classList.toggle("open");});
document.getElementById("clearHistory").addEventListener("click",()=>{
  history=[]; 
  localStorage.setItem(HISTORY_KEY,JSON.stringify(history)); 
  renderHistory(); 
  updateFirebaseHistory();
});
document.querySelectorAll('.order-row .qty-btn').forEach(b=>b.addEventListener('click',onOrderBtnClick));

function sklonujPaletu(c){
  if(c === 1) return "paletu";
  if(c > 1 && c < 5) return "palety";
  return "palet";
}

function sendMail(){
  const counts=[o1.value,o2.value,o3.value,o4.value].map(Number);
  let lines=[];
  counts.forEach((c,i)=>{
    if(c>0) lines.push(`${c} ${sklonujPaletu(c)} (${sklad[i].label})`);
  });
  if(lines.length===0){alert("Zadejte alespo≈à jednu polo≈æku."); return;}
  const body=`Dobr√Ω den,\n\npros√≠m v√°s o objedn√°n√≠ ta≈°ek na WM Hole≈°ovice\n${lines.join("\n")}\n\nDƒõkuji a p≈ôeji p≈ô√≠jemn√Ω zbytek dne.`;
  const gmailURL = `https://mail.google.com/mail/?view=cm&fs=1&to=sklad.hrusov@vas-solutions.cz&cc=jan.navratil@axm.cz,julie.husakova@wolt.com,wm.holesovice@wolt.com&su=Objedn√°vka ta≈°ek&body=${encodeURIComponent(body)}`;
  window.open(gmailURL, '_blank');

  const htext=lines.join(" | ");
  history.push({date:(new Date()).toLocaleString(),text:htext});
  if(history.length>HISTORY_LIMIT) history.shift();
  localStorage.setItem(HISTORY_KEY,JSON.stringify(history));
  updateFirebaseHistory();
  renderHistory();
}

document.getElementById("sendBtn").addEventListener("click",sendMail);
document.getElementById("resetBtn").addEventListener("click",()=>{o1.value=o2.value=o3.value=o4.value=0;});

const darkToggle=document.getElementById("darkToggle");
if(localStorage.getItem("THEME_KEY")==="dark"){document.body.classList.add("dark"); darkToggle.textContent="üåô";}
darkToggle.addEventListener("click",()=>{
  const isDark=document.body.classList.toggle("dark");
  localStorage.setItem("THEME_KEY",isDark?"dark":"light");
  darkToggle.textContent=isDark?"üåô":"üåû";
});

renderInventory();
renderHistory();
</script>
</body>
</html>






